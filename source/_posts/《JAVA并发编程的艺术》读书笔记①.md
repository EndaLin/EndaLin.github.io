---
title: 《JAVA并发编程的艺术》读书笔记①
copyright: true
date: 2019-06-01 17:50:59
tags: JAVA
---

# 上下文切换

在单核处理器下，支持多线程执行代码，CPU给每一个线程分配CPU时间片来实现这个机制，由于分配的时间片比较短，一般为几十毫秒，所以CPU需要不停地切换线程，在切换之前会通过程序计数器去保存上一个线程的任务状态，以便在下一次执行这个任务时，可以再次加载这个任务的状态。

任务从保存到再加载的过程就是一次上下文切换。

#### 问题：多线程一定快吗
答：不一定，因为多线程有上下文切换的开销。

#### 如何减少上下文切换

答：减少上下文切换的方法有无锁并发编程、CAS算法、使用最小线程和使用协程。

- 无锁并发编程：多线程竞争锁时，会引起上下文切换，所以多线程处理数据时，可以使用一些方法来避免使用锁
- CAS算法
- 使用最小线程：避免创建不需要的线程，避免造成大量线程处于等待状态
- 协程：在当线程里面实现多任务的调度，并在单线程里维持多个任务间的切换


# 如何避免死锁
- 避免在一个线程同时获取多个锁
- 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只用一个资源
- 尝试使用定时锁，使用lock,tryLock(timeout)来替代使用内部锁机制
- 对于数据库锁，加锁和解锁都必须在同一个数据库连接里，否则会出现解锁失败的情况

# 资源限制的问题
所谓资源限制，通常所指的是硬件的条件不能满足程序的需求，在这种情况下，多线程可能会延长执行时间，因为存在上下文切换的开销，这个时候，通常可以考虑集群并行执行程序。

在资源受限的情况下，需要根据具体的情况去决定程序的并发度，以达到最优状态。
